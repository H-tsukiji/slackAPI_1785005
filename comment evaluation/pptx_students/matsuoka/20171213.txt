時系列画像集合の類似度に基
づいた外観変化の検知手法の
検討


神奈川工科大学
情報学部
情報工学科


松岡
未紗
鷹野
孝典



研究
背景


.
観賞魚は環境適応能力が強まり，飼育経験の豊富で
ない人でもペットとして飼育可能
.
飼育
経験のない人にとって観賞魚の病気の早期発見
は
困難
.
観賞魚が小さいために，病気の時に現れる外観や動きの
変化に気づきにくい




健康


白点病


熱帯魚の体に白い斑点


尾腐れ病


ヒレや尻尾が
溶ける



研究動機


.
観賞魚
の病気の症状として外見の変化として表れる
特徴が
ある
.
体に寄生虫や白いカビが付着する
白点病
.
尾ひれ
や背びれが溶けたりボロボロに破れたりする尾腐れ病




.
固定カメラなどで
撮影した画像を基に外観変化を検
知する手法が観賞魚の病気の早期発見に
つながる


健康


白点病


尾腐れ病



関連研究


.
病気判定
.
画像
特徴を利用したイネ病気の判別・
分類［
2010
］
-
農業機械
學會誌
.
画像
処理によるキュウリの葉の病気
診断［
2011
］
-
愛知教育大
学研究
報告


.
類似度
.
画像処理を用いた研磨面の評価［
2016
］
-
精密
工学会


.
画像の回転・拡大を考慮した画像特徴量
.
ベルマークの画像識別［
2014
］
-
第
76
回全国大会講演論
文集





研究課題


.
観賞魚の外観の変化に着目して病気判定する場合，画
像認識技術を適用することが可能


.
下記の課題点がある
1.
観賞魚の個体の識別
2.
病気症状箇所が柄に混ざる可能性があるので，個
体別
の模様を考慮した上で外観の変化を
認識
.
類似度
を算出する際の比較データが１枚だけで
は判定材料が少なく正確な判定が困難





従来手法


.
単体画像の比較による類似度算出
.
欠点：画像の向き・角度・光の加減に影響されやすい
.
文献
[4]
SURF
特徴：向きによる類似度の影響
→
減少
可




角度・光の加減の影響
→
減少
不可


識別画像


初期画像


画像の


回転角度


少


中


大


類似度


高


中


低





提案方式


観賞魚
の
個体
画像集合
を
時系列で分類し，
画像
集合間類似度
の差分
を変化値として捉え
，外観
変化の検知方式を提案


Day
1


類似度の総和


7
0


類似度の総和


6
7


類似度の総和


55


Day
0


Day2


Day3


類似度の総和


7
5



提案方式
概要図


画像集合


（複数個体）


個
体
識
別


外
観
変
化
検
知


画像集合


（個体
A
）


画像集合


（個体
B
）


画像集合


（個体
C
）


画像集合


（個体
D
）


画像集合


（個体
A
）


画像集合


（個体
B
）


画像集合


（個体
C
）


画像集合


（個体
D
）


画像集合


（個体
A
）


画像集合


（個体
B
）


画像集合


（個体
C
）


画像集合


（個体
D
）


…


…


…


…


Day
1


Day
2


Day
n



個体の識別機能の概要図


個体画像


類似度スコア
を
算出


個体
A
画像集合


個体
A
初期画像集合


個体
画像
を


個体
A
画像集合に追加


差分
δ
x
(
t
p
, 
t
q
)
>
し
きい値
θ
2


Fals
e


画像
を削除


True


1.
これ
を繰り返し
，
追加
された個体
A
画像
集合
を学習データとして
，
個体
A
を
識別する
．
2.
個体
A
画像集合を時系
列に分割する．


学習データセット


+



個体識別機能のアプローチ


.
複数の個体が混在する状況において各個体の画像集合
を生成する
.
分類
された個体
A
の画像を時系列画像集合に分類する
.
他の個体画像においても閾値を超えた場合は類似度の
高いほうに追加される
.
個体
A
を識別するときに，それまでに識別された個
体
A
画像の和集合を学習データとする
.
利点
.
個体の外観変化に
よる識別
の精度低下を抑える





外観変化の検知機能
概要図


初期画像
集合


識別
する画像集合


類似度スコアを
算出


外観
変化検出


類似度
スコアの差分
δ
x
(
t
p
, 
t
q
)
を算
出


前日画像集合
との類似
度


δ
x
(
t
-
1, 
t
)
>
し
きい値
θ
2


True


Fals
e


外観変化なし


初期画像集合との類似度


差分
δ
x
(0, 
t
)
>
し
きい
値
θ
3


Fals
e


True


0


0.2


0.4


0.6


0.8


day1


day2


day3


day4


day5


day6


day7


day8


類似度


時系列


外観変化
検知



画像集合間の類似度の算出方法


.
各識別画像の類似度の合計を識別画像集合の類似度
とする
.
目的：画像の向き・角度・光の影響を減少




1
枚目


・
・
・


・
・
・


2
枚目


Ｎ枚目


1
枚目


2
枚目


Ｍ枚目


画像集合１


画像集合２


画像集合１と画像集合２の
1
枚
目の類似度


初期画像集合と識別画像
2
枚目
の類似度


…


初期画像集合と識別画像
M
枚
目の類似度


識別画像
1
枚目〜
M
枚目の類似度の合計
を識別画像集合の類似度とする



外観変化の検知方法


.
すべての画像集合において初期画像集合との類似度を算出
.
下記の類似度
の差分がしきい値を超えたら外観変化を検知
1.
前日の画像集合との類似度
の差分
2.
初期画像集合との類似度
の差分


Day
1


類似度の総和


70


類似度の総和


6
7


類似度の総和


55


差分：
3


差分：
12


Day
0


Day2


Day3
（発病）


類似度の総和


75


差分：
5


差分：
8


差分：
2
0


外観変化
を検知


外観変化
を検知



実験１
実験
目的


.
観賞魚の画像を用いて病気判定をする場合，画像
データを学習
データとする
必要が
ある
.
異なる
個体
模様の
学習
データ
から病気の検知が可
能
であるかは明らかでは
ない
.
異なる模様の画像を学習データとして代用した場
合の外観変化検知が可能であるか検証する



実験１
実験
データ


.
観賞魚の代用として千代紙を使用
.
似た柄
・色
の千代紙
2
種類を
1
組
，計
4
組を用意
（各
25
枚）
.
何
も加工を施さない場合を「健康
」
.
小さい白点を付与したものを「白点病
」


柄
A


柄
B


柄
A


柄
B


柄
A


柄
B


柄
A


柄
B


組み合
わせ
1


組み合わせ
2


組み合わせ
3


組み合わせ
4



実験１
実験
手順


.
柄
A
の健康画像と柄
B
の白点病画像を学習データ
.
柄
A
の白点病画像と柄
B
の健康画像を
CNN
を用いて判定
.
学習データと識別データを入れ替えた場合も同様に実験


柄
A
（健康）


柄
B
（白点病）


学習データ


柄
A
（健康）


×


柄
B
（
白点病
）


○


柄
A
（白点病）


柄で判別


代用不可


病気
で判別


代用
可



実験
１
実験
結果


.
4
組全てが，白点病の有無に関係なく柄ごとに
分類
.
例
：
柄
A
（
健康）
と
柄
B
（
白点病）
を学習データとした場
合，
柄
A
（
白点
）
は柄
A
（健康），
柄
B
（
健康
）
は柄
B
（白
点病）に分類


柄
A
（健康）


柄
B
（白点病）


学習データ


識別画像


柄
A
（白点病）


柄
B
（健康）


↓


↓


分類結果


柄
A
（健康）


×


柄
B
（白点病）


×





実験１
考察


.
異なる模様の画像を学習データとして代用した場合，
外観検知は困難


同じ個体模様の画像を


学習データとする必要がある



実験
２
目的


.
提案
手法である時系列画像集合間の類似度の差分から，
着目している画像データのわずかな外観変化の検知が
可能であるか検証
する


Day
1


類似度の総和


70


類似度の総和


6
7


類似度の総和


55


差分：
3


差分：
12


Day
0


Day2


Day3
（発病）


類似度の総和


75


差分：
5


差分：
8


差分：
2
0


外観変化
を検知


外観変化
を検知



実験
２
実験
データ


.
柄
の異なる
4
種類の千代紙を観賞魚の個体
A, B, C, D
と見立
てて用意（
各
50
枚）
.
時系列が進むごとに病気が進行と想定
.
何
も加工を施さない場合を「健康
」
（
Day0
）
.
小さい白点を付与したものを「白点病
」
（
Day1
〜
Day5
）
.
一部切り取ったものを「尾腐れ病
」
（
Day1
〜
Day5
）


Day1


Day2


Day3


個体
A


個体
B


個体
C


個体
D


個体
A
，
B
，
C
，
D
の画像データ例


個体
A
における時系列症状変化例



実験２
実験データ


症状


時間


区間


画像上の状態


画像枚数


健康


Day0


加工
なし


50
枚


尾腐れ病


Day1


一部切り取り（
1mm
）


50
枚


Day2


一部切り取り（
2mm
）


50
枚


Day3


一部切り取り（
3mm
）


50
枚


Day4


一部切り取り（
4mm
）


50
枚


Day5


一部切り取り（
5mm
）


50
枚


白点病


Day1


小さい白点（
1mm
φ
）


50
枚


Day2


小さい白点（
3mm
φ
）


50
枚


Day3


小さい白点（
5mm
φ
）


50
枚


Day4


小さい白点（
7mm
φ
）


50
枚


Day5


小さい白点（
9mm
φ
）


50
枚





実験２
実験
方法


.
以下の実験結果を比較することで
外観変化の検知が可
能であるか検証
1.
単体画像間の類似度
.
画像集合からランダム
に
3
ペア
を抽出し
比較


2.
画像集合間の類似度（提案手法）



実験２
実験結果：個体
A


4050607080Day0Day1Day2Day3Day4Day5
画像集合類似スコア
時間区間
4050607080Day0Day1Day2Day3Day4Day5
画像集合類似スコア
時間区間
尾腐れ病


白点病


単体画像間の類似度


画像集合間の類似度（提案手法）


00.050.10.150.20.250.30.35Day0Day1Day2Day3Day4Day5
ペア1ペア2ペア3
00.050.10.150.2Day0Day1Day2Day3Day4Day5
ペア1ペア2ペア3
実験
２
実験結果：個体
D


40455055606570Day0Day1Day2Day3Day4Day5
画像集合類似スコア
時間区間
40455055606570Day0Day1Day2Day3Day4Day5
画像集合類似スコア
時間区間
尾腐れ病


白点病


単体画像間の類似度


画像集合間の類似度（提案手法）


00.010.020.030.040.050.060.070.08Day0Day1Day2Day3Day4Day5
ペア1ペア2ペア3
00.010.020.030.040.050.060.070.080.09Day0Day1Day2Day3Day4Day5
ペア1ペア2ペア3
実験２
実験結果


.
類似度が
不安定
.
例：ペア
1
では変動が激しいがペア
2,3
では変動なし


.
時間の経過につれ
病気
の
進行を捉え
ることは困難


個体
A
（尾腐れ病）


単体画像間の
類似度


個体
A
（尾腐れ病）


画像集合間の類似度（提案手法）



実験２
実験結果


.
時間
が経過するごとに類似度が減少
.
特に，
Day0
と
Day1
間
で類似度が
大きく減少している
ため
Day1
で病気症状の発見が可能


個体
A
（尾腐れ病）


単体画像間の類似度


個体
A
（尾腐れ病）


画像集合間の類似度（提案手法）


外観変化検知


提案手法



考察


.
単体の画像データ間の類似度
で比較
する場合


→ 
着目している画像データの
外観変化の検知は
困難


.
提案方式の適用に
より
時
系列
画像集合間の類似度
で比
較する場合


→ 
着目している画像データの外観変化の検知が
可能


提案方式の適用に
より


個体の
症状変化を追跡が実現可能



実験２
実験結果


0102030405060Day0Day1Day2Day3Day4Day5
画像集合類似度スコア
時間区間
01020304050Day0Day1Day2Day3Day4Day5
画像集合類似度スコア
時間区間
020406080100120Day0Day1Day2Day3Day4Day5
画像集合類似度スコア
時間区間
020406080100Day0Day1Day2Day3Day4Day5
画像集合類似度スコア
時間区間
尾腐れ病


白点病


個体
B


個体
C



実験３


.
実験目的
.
個体識別機能を用いて個体分類が実現可能か検証


.
実験１のような似た色・柄については
CNN
で分類可
能
.
同じ柄で微妙に模様に変化をつけた場合分類可能か？



実験３


.
実験データ
.
模様を
2
か所異なる色に変更


original


red


green



実験３


.
実験手順
.
画像を各
30
枚用意
.
30
枚のうち学習データ
21
枚，テストデータ
9
枚をラン
ダムに振り分け
.
CNN
を用いて学習・分類



実験３


.
実験結果


original


green


red


27.78


38.89


27.78


22.22


88.89


22.22


27.78


94.44


11.11


27.78


38.89


38.89


平均


26.39


65.28


25




正答率（％）



実験３


.
実験１のデータを利用して
CNN
で分類
.
学習データ
14
枚，テストデータ
6
枚


柄
A


柄
B


柄
G


柄
F


柄
E


柄
D


柄
C


柄
H


柄
A


柄
B


柄
C


柄
D


柄
E


柄
F


柄
G


柄
H


健康


50


50


85.71


100


0


71.43


42.86


57.14


白点病


71.43


64.29


14.29


0


100


28.57


50


28.57




正答率（％）



まとめ


.
提案方式
.
観賞魚の個体画像集合を時系列で分類し，
画像集合
間類似度の差分
を変化値として捉え，外観変化の検
知方式を提案


.
今後の課題
.
今回の実験で使用した模様以外でも
病気の症状を検
知可能で
ある
か
.
千代紙
でなく観賞魚に適用できる
か
.
画像集合に最低限必要な画像枚数の検証
.
外観変化を検知した場合，病気の判定
.
GoogLeNet
（転移学習）





.
実際の観賞魚の場合，対象が動くため他のタイミングで撮影す
るのか，また背景の海藻などのノイズの影響を受けてしまうので
は
→
前処理（エッジ抽出）
.
どの
ように対象である観賞魚の画像範囲を決めるのか
(
判別を行
うのか
)
.
画像
の変化量を検知した後にどのような病気なのかを分類する
.
成長
の変化と病気の変化の判別をつける案
(
今後におけるビジョ
ン
)
はありますか
.
類似度
をどのように見ているのか
(
学習時に健康個体の特徴量
(
た
ぶん
1
次元の値
)
を基にしているのか，比較画像を重ね合わせてそ
の差分をとるような類似度なのか
)
.
白点病
ではたくさんあるように見えたが実験の一つの点を大き
くする変化は妥当なの
か
→
白点が増えていく場合も実験
.
どのように判定
することで観賞魚が助かるラインを決めるのか．



